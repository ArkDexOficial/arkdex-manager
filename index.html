<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARKDEX | Pro Manager Cloud</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f1216;
            --card-bg: #1a1f26;
            --text-main: #ffffff;
            --text-dim: #94a3b8;
            --primary: #00f2ff; 
            --primary-glow: rgba(0, 242, 255, 0.15);
            --success: #10b981;
            --danger: #f43f5e;
            --warning: #fbbf24;
            --permanent: #6366f1;
            --border: #2d3643;
            --input-bg: #090b0e;
        }

        /* --- ESTILOS GERAIS --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background-color: var(--bg); color: var(--text-main); padding: 20px; line-height: 1.6; }
        .container { max-width: 1240px; margin: auto; display: none; }

        /* --- LOGIN --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            background: var(--card-bg); padding: 40px; border-radius: 20px; border: 1px solid var(--border);
            width: 100%; max-width: 400px; text-align: center;
        }

        header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        header h1 { font-size: 2.5rem; font-weight: 800; }
        header h1 span { color: var(--primary); }

        .insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .insight-card { background: rgba(255,255,255,0.03); border: 1px dashed var(--border); padding: 15px; border-radius: 12px; }
        .insight-label { font-size: 0.65rem; text-transform: uppercase; color: var(--text-dim); font-weight: 700; }
        .insight-value { font-size: 1.1rem; font-weight: 700; color: var(--primary); display: block; }

        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card-bg); padding: 25px; border-radius: 16px; border: 1px solid var(--border); position: relative; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--primary); border-radius: 16px 0 0 16px; }

        .form-section { background: var(--card-bg); padding: 30px; border-radius: 16px; border: 1px solid var(--border); margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        
        select, input, textarea { background: var(--input-bg); border: 1px solid var(--border); color: white; padding: 12px 15px; border-radius: 8px; width: 100%; }
        textarea { height: 80px; grid-column: span 2; }

        #btn-add { 
            width: 100%; background: var(--primary); color: #000; font-weight: 800; padding: 15px; border-radius: 10px; 
            cursor: pointer; border: none; margin-top: 15px; text-transform: uppercase;
        }

        .table-container { background: var(--card-bg); border-radius: 16px; border: 1px solid var(--border); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border); }

        .log-display { margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; font-size: 0.7rem; color: var(--text-dim); max-height: 100px; overflow-y: auto; }

        /* --- RESPONSIVIDADE CELULAR --- */
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            textarea { grid-column: span 1; }
            header h1 { font-size: 1.8rem; }
        }

        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .status-active { background: var(--success); color: #000; }
        .status-expired { background: var(--danger); color: #fff; }
        .vip-tag { padding: 2px 6px; border-radius: 4px; font-size: 0.6rem; margin-left: 5px; color: #fff; }
        .tag-elite { background: #0ea5e9; }
        .tag-supremo { background: #f59e0b; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h1 style="color: white; margin-bottom: 20px;">ARK<span>DEX</span> LOGIN</h1>
        <input type="email" id="email" placeholder="E-mail" style="margin-bottom: 10px;">
        <input type="password" id="password" placeholder="Senha" style="margin-bottom: 20px;">
        <button onclick="login()" style="width: 100%; background: var(--primary); color: #000; font-weight: 800; padding: 15px; border-radius: 10px; cursor: pointer; border: none;">ENTRAR</button>
    </div>
</div>

<div class="container" id="main-app">
    <header>
        <h1>ARK<span>DEX</span></h1>
        <p id="data-atual"></p>
        <button onclick="logout()" style="background:none; border:1px solid var(--border); color:var(--text-dim); padding:5px 10px; border-radius:5px; cursor:pointer; margin-top:10px;">Sair</button>
    </header>

    <div class="insights-grid">
        <div class="insight-card"><span class="insight-label">üéØ Plano Popular</span><span class="insight-value" id="planoPopular">-</span></div>
        <div class="insight-card"><span class="insight-label">üîî Vencendo Logo</span><span class="insight-value" id="vencendoLogo">0</span></div>
        <div class="insight-card"><span class="insight-label">üí∞ Receita Anual</span><span class="insight-value" id="resumoGeralHeader">R$ 0,00</span></div>
    </div>

    <div class="form-section">
        <div class="form-grid">
            <input type="hidden" id="edit-id">
            <textarea id="nome" placeholder="ID Steam (Um por linha para combos)"></textarea>
            <select id="tipoVip">
                <option value="VIP UNLOKED">VIP UNLOKED</option>
                <option value="VIP ELITE">VIP ELITE</option>
                <option value="VIP IMPERADOR">VIP IMPERADOR</option>
                <option value="VIP LEND√ÅRIO">VIP LEND√ÅRIO</option>
                <option value="VIP EXTREME">VIP EXTREME</option>
                <option value="VIP SUPREMO">VIP SUPREMO</option>
                <option value="OUTROS">OUTROS</option>
            </select>
            <input type="date" id="dataCompra">
            <input type="number" id="valor" placeholder="Valor R$">
            <input type="number" id="duracao" placeholder="Dura√ß√£o (Dias)">
            <input type="text" id="obs" placeholder="Observa√ß√µes" style="grid-column: span 2;">
        </div>
        <button id="btn-add" onclick="processarVip()">LAN√áAR REGISTRO</button>
        <div class="log-display" id="logDisplay">Aguardando login...</div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr><th>ID / Plano</th><th>Valor</th><th>Compra</th><th>Vencimento</th><th>Status</th><th>A√ß√µes</th></tr>
            </thead>
            <tbody id="tabelaVips"></tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCoObGx8rVkUVdau2zeU2azChGvmmidHcA",
        authDomain: "arkdex-3ce32.firebaseapp.com",
        databaseURL: "https://arkdex-3ce32-default-rtdb.firebaseio.com",
        projectId: "arkdex-3ce32",
        storageBucket: "arkdex-3ce32.appspot.com",
        messagingSenderId: "33403949116",
        appId: "1:33403949116:web:b9e61305ae4b7cf0dd7339"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    let vipsGlobais = [];

    function login() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(email, pass).catch(e => alert("Erro: " + e.message));
    }

    function logout() { auth.signOut(); }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            carregarDados();
        } else {
            document.getElementById('login-overlay').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
        }
    });

    function carregarDados() {
        document.getElementById('dataCompra').valueAsDate = new Date();
        db.ref('vips').on('value', (snapshot) => {
            const data = snapshot.val();
            vipsGlobais = data ? Object.values(data) : [];
            mostrarVips();
        });
    }

    function processarVip() {
        const idEdit = document.getElementById('edit-id').value;
        const nome = document.getElementById('nome').value.toUpperCase().trim();
        const tipoVip = document.getElementById('tipoVip').value;
        const dataCompra = document.getElementById('dataCompra').value;
        const valor = parseFloat(document.getElementById('valor').value) || 0;
        const duracao = parseInt(document.getElementById('duracao').value) || 0;
        const obs = document.getElementById('obs').value;

        if (!nome || !dataCompra) { alert("Preencha ID e Data!"); return; }

        let vencimento = "-";
        if (duracao > 0) {
            let d = new Date(dataCompra + 'T00:00:00');
            d.setDate(d.getDate() + duracao);
            vencimento = d.toISOString().split('T')[0];
        }

        const id = idEdit || Date.now().toString();
        const reg = { id, nome, tipoVip, valor, dataCompra, duracao, vencimento, obs };

        db.ref('vips/' + id).set(reg)
            .then(() => {
                alert("Sucesso!");
                limparCampos();
            })
            .catch(e => {
                console.error(e);
                alert("Erro ao salvar. Verifique o console.");
            });
    }

    function mostrarVips() {
        const tabela = document.getElementById('tabelaVips');
        tabela.innerHTML = '';
        let faturamentoTotal = 0;

        vipsGlobais.forEach(vip => {
            faturamentoTotal += vip.valor;
            const hoje = new Date(); hoje.setHours(0,0,0,0);
            const dVenc = vip.vencimento !== "-" ? new Date(vip.vencimento + 'T00:00:00') : null;
            const expirado = dVenc && dVenc < hoje;

            tabela.innerHTML += `
                <tr>
                    <td><strong>${vip.nome}</strong> <span class="vip-tag tag-elite">${vip.tipoVip}</span></td>
                    <td>R$ ${vip.valor.toFixed(2)}</td>
                    <td>${vip.dataCompra}</td>
                    <td>${vip.vencimento}</td>
                    <td><span class="badge ${expirado ? 'status-expired' : 'status-active'}">${expirado ? 'EXPIRADO' : 'ATIVO'}</span></td>
                    <td>
                        <button onclick="editarVip('${vip.id}')">Editar</button>
                        <button onclick="removerVip('${vip.id}')">Del</button>
                    </td>
                </tr>`;
        });
        document.getElementById('resumoGeralHeader').innerText = `R$ ${faturamentoTotal.toFixed(2)}`;
    }

    function editarVip(id) {
        const v = vipsGlobais.find(v => v.id == id);
        document.getElementById('edit-id').value = v.id;
        document.getElementById('nome').value = v.nome;
        document.getElementById('valor').value = v.valor;
        document.getElementById('duracao').value = v.duracao;
        document.getElementById('btn-add').innerText = "ATUALIZAR";
    }

    function removerVip(id) {
        if(confirm("Excluir?")) db.ref('vips/' + id).remove();
    }

    function limparCampos() {
        document.getElementById('edit-id').value = '';
        document.getElementById('nome').value = '';
        document.getElementById('valor').value = '';
        document.getElementById('duracao').value = '';
        document.getElementById('btn-add').innerText = "LAN√áAR REGISTRO";
    }
</script>
</body>
</html>
